# Overview
This repo contain the code for the Splittab model endpoint for inference. This is to be deploy
to Runpod Serverless.

## Get Started
1. Create a `.env`file with the following variables:

    ```bash 
    LOCAL_MODEL_DIR: The path to the model directory. (e.g. /home/.../splittab-runpod/model/)
    ```
2. Follow the instructions provided by [RunPod Blog](https://docs.runpod.io/serverless/workers/get-started) for deploying the model endpoint.

## Local Development
You can launch a local test server that will provide an endpoint to send request
to by running the following command:
```bash
make test-server
```

## Deployment
After merging changes to main, run the following command to deploy the model endpoint:
```bash
# Make sure that you're sign into Docker Desktop
make push # push image to Docker Registry
```

**Note**
While you can pull images from AWS ECR in RunPod, the authentication to AWS ECR relies on short-lived tokens (valid for 12 hours) generated by the aws ecr get-login-password command. 
Currently, RunPod does not have a built-in mechanism to automatically refresh these tokens. Therefore, users need to manually reauthenticate or automate this process by creating a 
script or cron job that regularly generates new tokens and updates the RunPod registry credentials through RunPod's GraphQL APIâ€‹
